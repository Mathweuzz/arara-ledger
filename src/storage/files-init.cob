>>SOURCE FORMAT FREE
*> ------------------------------------------------------------
*> Programa: files-init.cob
*> Objetivo:
*>   - Criar/organizar os três arquivos indexados:
*>     ACCOUNTS, JOURNAL e LEDGER.
*>   - Definir RECORD KEY e ALTERNATE RECORD KEY (JOURNAL).
*>   - Exibir FILE STATUS das operações de criação/fechamento.
*> ------------------------------------------------------------
IDENTIFICATION DIVISION.
PROGRAM-ID. FILES-INIT.

ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT ACCOUNTS-FILE ASSIGN TO "data/accounts.dat"
        ORGANIZATION IS INDEXED
        ACCESS MODE   IS DYNAMIC
        RECORD KEY    IS AC-ACCOUNT-ID
        FILE STATUS   IS FS-ACCOUNTS.

    SELECT JOURNAL-FILE ASSIGN TO "data/journal.dat"
        ORGANIZATION IS INDEXED
        ACCESS MODE   IS DYNAMIC
        RECORD KEY    IS JR-TXN-ID
        ALTERNATE RECORD KEY IS JR-ALT-KEY WITH DUPLICATES
        FILE STATUS   IS FS-JOURNAL.

    SELECT LEDGER-FILE ASSIGN TO "data/ledger.dat"
        ORGANIZATION IS INDEXED
        ACCESS MODE   IS DYNAMIC
        RECORD KEY    IS LG-KEY
        FILE STATUS   IS FS-LEDGER.

DATA DIVISION.
FILE SECTION.

FD  ACCOUNTS-FILE.
COPY "accounts.cpy".

FD  JOURNAL-FILE.
COPY "journal.cpy".

FD  LEDGER-FILE.
COPY "ledger.cpy".

WORKING-STORAGE SECTION.
COPY "common.cpy".

01 FS-ACCOUNTS PIC XX.
01 FS-JOURNAL  PIC XX.
01 FS-LEDGER   PIC XX.

01 WS-MSG-LABEL PIC X(40).

PROCEDURE DIVISION.
MAIN-PARA.
    DISPLAY "ARARA LEDGER - INITIALIZACAO DE ARQUIVOS".
    DISPLAY "----------------------------------------".

    PERFORM INIT-ACCOUNTS.
    PERFORM INIT-JOURNAL.
    PERFORM INIT-LEDGER.

    DISPLAY "----------------------------------------".
    DISPLAY "Inicializacao concluida.".
    STOP RUN.

INIT-ACCOUNTS.
    DISPLAY "Criando arquivo ACCOUNTS...".
    MOVE SPACES TO FS-ACCOUNTS.
    OPEN OUTPUT ACCOUNTS-FILE
    PERFORM SHOW-STATUS-ACCOUNTS
    CLOSE ACCOUNTS-FILE
    PERFORM SHOW-STATUS-ACCOUNTS
    .

INIT-JOURNAL.
    DISPLAY "Criando arquivo JOURNAL...".
    MOVE SPACES TO FS-JOURNAL.
    OPEN OUTPUT JOURNAL-FILE
    PERFORM SHOW-STATUS-JOURNAL
    CLOSE JOURNAL-FILE
    PERFORM SHOW-STATUS-JOURNAL
    .

INIT-LEDGER.
    DISPLAY "Criando arquivo LEDGER...".
    MOVE SPACES TO FS-LEDGER.
    OPEN OUTPUT LEDGER-FILE
    PERFORM SHOW-STATUS-LEDGER
    CLOSE LEDGER-FILE
    PERFORM SHOW-STATUS-LEDGER
    .

SHOW-STATUS-ACCOUNTS.
    IF FS-ACCOUNTS = FS-OK
        MOVE "ACCOUNTS STATUS (OK): " TO WS-MSG-LABEL
    ELSE
        MOVE "ACCOUNTS STATUS (ERRO): " TO WS-MSG-LABEL
    END-IF
    DISPLAY WS-MSG-LABEL FS-ACCOUNTS
    .

SHOW-STATUS-JOURNAL.
    IF FS-JOURNAL = FS-OK
        MOVE "JOURNAL STATUS (OK): " TO WS-MSG-LABEL
    ELSE
        MOVE "JOURNAL STATUS (ERRO): " TO WS-MSG-LABEL
    END-IF
    DISPLAY WS-MSG-LABEL FS-JOURNAL
    .

SHOW-STATUS-LEDGER.
    IF FS-LEDGER = FS-OK
        MOVE "LEDGER STATUS (OK): " TO WS-MSG-LABEL
    ELSE
        MOVE "LEDGER STATUS (ERRO): " TO WS-MSG-LABEL
    END-IF
    DISPLAY WS-MSG-LABEL FS-LEDGER
    .
